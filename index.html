<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상업경제 기출 DB</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", sans-serif;
        background-color: #ffffff;
        color: #374151;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
      }

      .header {
        padding: 64px 0 48px 0;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 8px;
        letter-spacing: -0.025em;
      }

      .nav-links {
        padding: 32px 0;
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
      }

      .nav-links a {
        display: inline-flex;
        align-items: center;
        padding: 12px 20px;
        background-color: #ffffff;
        color: #374151;
        text-decoration: none;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.15s ease;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }

      .nav-links a:hover {
        background-color: #f9fafb;
        border-color: #9ca3af;
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .nav-links a.active {
        background-color: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .content {
        padding: 48px 0;
        padding-top: 0;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
      }

      th,
      td {
        border: none;
        padding: 16px 20px;
        text-align: left;
        border-bottom: 1px solid #f3f4f6;
      }

      th {
        background-color: #f9fafb;
        color: #374151;
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      tr:last-child td {
        border-bottom: none;
      }

      tr:hover {
        background-color: #f9fafb;
      }

      .priority-1 {
        background-color: #fef2f2;
      }

      .priority-2 {
        background-color: #fffbeb;
      }

      .priority-3 {
        background-color: #ffffff;
      }

      .priority-1:hover {
        background-color: #fee2e2;
      }

      .priority-2:hover {
        background-color: #fef3c7;
      }

      .priority-3:hover {
        background-color: #f9fafb;
      }

      .floating-scroll {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .scroll-btn {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        background: rgba(59, 130, 246, 0.9);
        color: white;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.2s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .scroll-btn:hover {
        background: rgba(59, 130, 246, 1);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }

      .scroll-btn:active {
        transform: translateY(0);
      }

      .scroll-btn.top {
        background: rgba(239, 68, 68, 0.9);
      }

      .scroll-btn.top:hover {
        background: rgba(239, 68, 68, 1);
      }

      .scroll-btn.bottom {
        background: rgba(34, 197, 94, 0.9);
      }

      .scroll-btn.bottom:hover {
        background: rgba(34, 197, 94, 1);
      }

      .github-link {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      .github-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        text-decoration: none;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .github-btn:hover {
        background: rgba(0, 0, 0, 0.9);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .github-icon {
        width: 16px;
        height: 16px;
        fill: currentColor;
      }

      .error-message {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #991b1b;
        padding: 16px 20px;
        border-radius: 8px;
        text-align: center;
        margin: 24px 0;
        font-size: 0.875rem;
      }

      .info-message {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        color: #1e40af;
        padding: 16px 20px;
        border-radius: 8px;
        text-align: center;
        margin: 24px 0;
        font-size: 0.875rem;
      }

      .chapters-overview {
        margin-top: 48px;
      }

      .chapter-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
        transition: all 0.15s ease;
      }

      .chapter-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      @media (max-width: 768px) {
        .container {
          padding: 0 16px;
        }

        .header {
          padding: 48px 0 32px 0;
        }

        .header h1 {
          font-size: 2rem;
        }

        .nav-links {
          padding: 24px 0;
          gap: 12px;
        }

        .nav-links a {
          padding: 10px 16px;
          font-size: 0.8rem;
        }

        .content {
          padding: 32px 0;
        }

        th,
        td {
          padding: 12px 16px;
          font-size: 0.875rem;
        }

        .floating-scroll {
          right: 16px;
          bottom: 16px;
        }

        .scroll-btn {
          width: 45px;
          height: 45px;
          font-size: 16px;
        }

        .github-link {
          top: 16px;
          right: 16px;
        }

        .github-btn {
          padding: 6px 12px;
          font-size: 12px;
        }

        .github-icon {
          width: 14px;
          height: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <a style="text-decoration: none; color: inherit" href="/index.html"
          ><h1>상업경제 기출 DB</h1></a
        >
      </div>

      <div class="nav-links">
        <a href="index.html" class="active">데이터 보기</a>
        <a href="stats.html">통계 정보</a>
      </div>

      <div
        class="filter-controls"
        style="
          margin: 32px 0;
          padding: 24px;
          background: #f9fafb;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        "
      >
        <h3
          style="
            margin-bottom: 16px;
            color: #374151;
            font-size: 1.1rem;
            font-weight: 600;
          "
        >
          필터 옵션
        </h3>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
          "
        >
          <div>
            <label
              style="
                display: block;
                margin-bottom: 8px;
                color: #374151;
                font-weight: 500;
                font-size: 0.875rem;
              "
              >우선순위</label
            >
            <select
              id="priority-filter"
              style="
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background: white;
                font-size: 0.875rem;
              "
            >
              <option value="">모든 우선순위</option>
              <option value="1">Priority 1 (높음)</option>
              <option value="2">Priority 2 (중간)</option>
              <option value="3">Priority 3 (낮음)</option>
            </select>
          </div>
          <div>
            <label
              style="
                display: block;
                margin-bottom: 8px;
                color: #374151;
                font-weight: 500;
                font-size: 0.875rem;
              "
              >챕터</label
            >
            <select
              id="chapter-filter"
              style="
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background: white;
                font-size: 0.875rem;
              "
            >
              <option value="">모든 챕터</option>
            </select>
          </div>
          <div>
            <label
              style="
                display: block;
                margin-bottom: 8px;
                color: #374151;
                font-weight: 500;
                font-size: 0.875rem;
              "
              >테마</label
            >
            <select
              id="theme-filter"
              style="
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background: white;
                font-size: 0.875rem;
              "
            >
              <option value="">모든 테마</option>
            </select>
          </div>
        </div>
        <div
          style="
            margin-top: 16px;
            display: flex;
            gap: 12px;
            align-items: center;
          "
        >
          <button
            id="apply-filter"
            style="
              padding: 8px 16px;
              background: #3b82f6;
              color: white;
              border: none;
              border-radius: 6px;
              font-weight: 500;
              cursor: pointer;
              font-size: 0.875rem;
            "
          >
            필터 적용
          </button>
          <button
            id="clear-filter"
            style="
              padding: 8px 16px;
              background: #6b7280;
              color: white;
              border: none;
              border-radius: 6px;
              font-weight: 500;
              cursor: pointer;
              font-size: 0.875rem;
            "
          >
            필터 초기화
          </button>
          <span
            id="filter-count"
            style="color: #6b7280; font-size: 0.875rem"
          ></span>
        </div>
      </div>

      <div class="content">
        <div id="csv-table"></div>
      </div>
    </div>

    <div class="floating-scroll">
      <button class="scroll-btn top" id="scrollToTop" title="맨 위로">↑</button>
      <button class="scroll-btn bottom" id="scrollToBottom" title="맨 아래로">
        ↓
      </button>
    </div>

    <div class="github-link">
      <a
        href="https://github.com/SID12g/sangup_classification"
        target="_blank"
        class="github-btn"
        title="GitHub 저장소"
      >
        <svg class="github-icon" viewBox="0 0 24 24">
          <path
            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
          />
        </svg>
        GitHub
      </a>
    </div>

    <script>
      let allCsvData = [];
      let filteredData = [];
      let currentTable = null;

      function parseCsvRow(rowString) {
        const cells = [];
        let currentPos = 0;

        // First column (unquoted)
        const firstComma = rowString.indexOf(",");
        if (firstComma === -1) {
          return [rowString];
        }
        cells.push(rowString.substring(0, firstComma));
        currentPos = firstComma + 1;

        // Other columns (quoted)
        while (currentPos < rowString.length) {
          if (rowString[currentPos] === '"') {
            let endQuote = -1;
            let searchPos = currentPos + 1;
            while (endQuote === -1) {
              const nextQuote = rowString.indexOf('"', searchPos);
              if (nextQuote === -1) {
                // Malformed, no closing quote
                endQuote = rowString.length;
              } else if (rowString[nextQuote + 1] === '"') {
                // Escaped quote
                searchPos = nextQuote + 2;
              } else {
                endQuote = nextQuote;
              }
            }
            cells.push(
              rowString.substring(currentPos + 1, endQuote).replace(/""/g, '"')
            );
            currentPos = endQuote + 2; // Move past quote and comma
          } else {
            // Fallback for unquoted values, though not expected in this format
            const nextComma = rowString.indexOf(",", currentPos);
            if (nextComma === -1) {
              cells.push(rowString.substring(currentPos));
              currentPos = rowString.length;
            } else {
              cells.push(rowString.substring(currentPos, nextComma));
              currentPos = nextComma + 1;
            }
          }
        }
        return cells;
      }

      function loadCsvData(csvFile) {
        return fetch(csvFile)
          .then((response) => response.text())
          .then((data) => {
            const rows = data.trim().split("\n");
            const headers = rows[0].split(",");
            const parsedData = [];

            for (let i = 1; i < rows.length; i++) {
              if (!rows[i]) continue;
              try {
                const cells = parseCsvRow(rows[i]);
                parsedData.push({
                  chapter: cells[0]?.replace(/"/g, ""),
                  theme: cells[1]?.replace(/"/g, ""),
                  problemNumber: cells[2]?.replace(/"/g, ""),
                  reason: cells[3]?.replace(/"/g, ""),
                  priority: cells[4]?.replace(/"/g, ""),
                  originalRow: rows[i],
                });
              } catch (error) {
                console.error("Error parsing row:", i + 2, rows[i], error);
              }
            }

            return { headers, data: parsedData };
          });
      }

      function populateFilterOptions(data) {
        const chapters = [
          ...new Set(data.map((item) => item.chapter).filter(Boolean)),
        ];
        const themes = [
          ...new Set(data.map((item) => item.theme).filter(Boolean)),
        ];

        const chapterFilter = document.getElementById("chapter-filter");
        const themeFilter = document.getElementById("theme-filter");

        chapterFilter.innerHTML = '<option value="">모든 챕터</option>';
        chapters.forEach((chapter) => {
          const option = document.createElement("option");
          option.value = chapter;
          option.textContent = chapter;
          chapterFilter.appendChild(option);
        });

        themeFilter.innerHTML = '<option value="">모든 테마</option>';
        themes.forEach((theme) => {
          const option = document.createElement("option");
          option.value = theme;
          option.textContent = theme;
          themeFilter.appendChild(option);
        });

        chapterFilter.addEventListener("change", function () {
          updateThemeOptions(data, this.value);
        });
      }

      function updateThemeOptions(data, selectedChapter) {
        const themeFilter = document.getElementById("theme-filter");
        themeFilter.innerHTML = '<option value="">모든 테마</option>';

        if (selectedChapter) {
          const chapterThemes = data
            .filter((item) => item.chapter === selectedChapter)
            .map((item) => item.theme)
            .filter(Boolean);

          const uniqueThemes = [...new Set(chapterThemes)];

          uniqueThemes.forEach((theme) => {
            const option = document.createElement("option");
            option.value = theme;
            option.textContent = theme;
            themeFilter.appendChild(option);
          });
        } else {
          const allThemes = [
            ...new Set(data.map((item) => item.theme).filter(Boolean)),
          ];

          allThemes.forEach((theme) => {
            const option = document.createElement("option");
            option.value = theme;
            option.textContent = theme;
            themeFilter.appendChild(option);
          });
        }

        themeFilter.value = "";
      }

      function applyFilters() {
        const priorityFilter = document.getElementById("priority-filter").value;
        const chapterFilter = document.getElementById("chapter-filter").value;
        const themeFilter = document.getElementById("theme-filter").value;

        filteredData = allCsvData.filter((item) => {
          const priorityMatch =
            !priorityFilter || item.priority === priorityFilter;
          const chapterMatch = !chapterFilter || item.chapter === chapterFilter;
          const themeMatch = !themeFilter || item.theme === themeFilter;

          return priorityMatch && chapterMatch && themeMatch;
        });

        displayFilteredTable();
        updateFilterCount();
      }

      function displayFilteredTable() {
        const container = document.getElementById("csv-table");
        container.innerHTML = "";

        if (filteredData.length === 0) {
          container.innerHTML =
            '<div class="info-message">선택한 조건에 맞는 문제가 없습니다.</div>';
          return;
        }

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        const headers = [
          "Chapter",
          "Theme",
          "문제 번호",
          "분류 이유",
          "Priority",
        ];
        headers.forEach((headerText) => {
          const th = document.createElement("th");
          th.textContent = headerText;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        filteredData.forEach((item) => {
          const row = document.createElement("tr");

          const chapterTd = document.createElement("td");
          chapterTd.textContent = item.chapter;
          row.appendChild(chapterTd);

          const themeTd = document.createElement("td");
          themeTd.textContent = item.theme;
          row.appendChild(themeTd);

          const problemTd = document.createElement("td");
          problemTd.textContent = item.problemNumber;
          row.appendChild(problemTd);

          const reasonTd = document.createElement("td");
          reasonTd.textContent = item.reason;
          row.appendChild(reasonTd);

          const priorityTd = document.createElement("td");
          priorityTd.textContent = item.priority;
          row.appendChild(priorityTd);

          if (item.priority === "1") {
            row.classList.add("priority-1");
          } else if (item.priority === "2") {
            row.classList.add("priority-2");
          } else if (item.priority === "3") {
            row.classList.add("priority-3");
          }

          tbody.appendChild(row);
        });
        table.appendChild(tbody);

        container.appendChild(table);
        currentTable = table;
      }

      function updateFilterCount() {
        const countElement = document.getElementById("filter-count");
        countElement.textContent = `총 ${filteredData.length}개 문제 표시`;
      }

      function clearFilters() {
        document.getElementById("priority-filter").value = "";
        document.getElementById("chapter-filter").value = "";
        document.getElementById("theme-filter").value = "";
        filteredData = [...allCsvData];
        displayFilteredTable();
        updateFilterCount();
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadCsvData("all.csv")
          .then(({ data }) => {
            allCsvData = data;
            populateFilterOptions(allCsvData);
            applyFilters();
          })
          .catch((error) => {
            console.error("Error loading CSV file:", error);
            document.getElementById(
              "csv-table"
            ).innerHTML = `<div class="error-message">Error loading all.csv. Please make sure the file exists and is in the same directory as this HTML file.</div>`;
          });

        document
          .getElementById("apply-filter")
          .addEventListener("click", applyFilters);
        document
          .getElementById("clear-filter")
          .addEventListener("click", clearFilters);

        document.getElementById("scrollToTop").addEventListener("click", () => {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        });

        document
          .getElementById("scrollToBottom")
          .addEventListener("click", () => {
            window.scrollTo({
              top: document.body.scrollHeight,
              behavior: "smooth",
            });
          });
      });
    </script>
  </body>
  <footer style="text-align: center; padding: 20px; font-size: 12px">
    Copyright ⓒ 2025
    <a href="https://sid12g.dev" style="color: #000000; text-decoration: none"
      >sid12g</a
    >
    All rights reserved.
  </footer>
</html>
