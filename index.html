<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상업경제 기출 DB</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", sans-serif;
        background-color: #ffffff;
        color: #374151;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
      }

      .header {
        padding: 64px 0 48px 0;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 8px;
        letter-spacing: -0.025em;
      }

      .csv-links {
        padding: 48px 0;
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
      }

      .csv-links a {
        display: inline-flex;
        align-items: center;
        padding: 12px 20px;
        background-color: #ffffff;
        color: #374151;
        text-decoration: none;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.15s ease;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }

      .csv-links a:hover {
        background-color: #f9fafb;
        border-color: #9ca3af;
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .content {
        padding: 48px 0;
        padding-top: 0;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
      }

      th,
      td {
        border: none;
        padding: 16px 20px;
        text-align: left;
        border-bottom: 1px solid #f3f4f6;
      }

      th {
        background-color: #f9fafb;
        color: #374151;
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      tr:last-child td {
        border-bottom: none;
      }

      tr:hover {
        background-color: #f9fafb;
      }

      .priority-1 {
        background-color: #fef2f2;
      }

      .priority-2 {
        background-color: #fffbeb;
      }

      .priority-3 {
        background-color: #ffffff;
      }

      .priority-1:hover {
        background-color: #fee2e2;
      }

      .priority-2:hover {
        background-color: #fef3c7;
      }

      .priority-3:hover {
        background-color: #f9fafb;
      }

      .floating-scroll {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .scroll-btn {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        background: rgba(59, 130, 246, 0.9);
        color: white;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.2s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .scroll-btn:hover {
        background: rgba(59, 130, 246, 1);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }

      .scroll-btn:active {
        transform: translateY(0);
      }

      .scroll-btn.top {
        background: rgba(239, 68, 68, 0.9);
      }

      .scroll-btn.top:hover {
        background: rgba(239, 68, 68, 1);
      }

      .scroll-btn.bottom {
        background: rgba(34, 197, 94, 0.9);
      }

      .scroll-btn.bottom:hover {
        background: rgba(34, 197, 94, 1);
      }

      .error-message {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #991b1b;
        padding: 16px 20px;
        border-radius: 8px;
        text-align: center;
        margin: 24px 0;
        font-size: 0.875rem;
      }

      .info-message {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        color: #1e40af;
        padding: 16px 20px;
        border-radius: 8px;
        text-align: center;
        margin: 24px 0;
        font-size: 0.875rem;
      }

      .chapters-overview {
        margin-top: 48px;
      }

      .chapter-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
        transition: all 0.15s ease;
      }

      .chapter-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      @media (max-width: 768px) {
        .container {
          padding: 0 16px;
        }

        .header {
          padding: 48px 0 32px 0;
        }

        .header h1 {
          font-size: 2rem;
        }

        .csv-links {
          padding: 32px 0;
          gap: 12px;
        }

        .csv-links a {
          padding: 10px 16px;
          font-size: 0.8rem;
        }

        .content {
          padding: 32px 0;
        }

        th,
        td {
          padding: 12px 16px;
          font-size: 0.875rem;
        }

        .floating-scroll {
          right: 16px;
          bottom: 16px;
        }

        .scroll-btn {
          width: 45px;
          height: 45px;
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <a
          style="text-decoration: none; color: inherit"
          href="/sangup_classification"
          ><h1>상업경제 기출 DB</h1></a
        >
      </div>

      <div class="csv-links">
        <a href="?csv=1.csv">Chapter 01</a>
        <a href="?csv=2.csv">Chapter 02</a>
        <a href="?csv=3.csv">Chapter 03</a>
        <a href="?csv=4.csv">Chapter 04</a>
        <a href="?csv=all.csv">All</a>
      </div>

      <div
        class="filter-controls"
        style="
          margin: 32px 0;
          padding: 24px;
          background: #f9fafb;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        "
      >
        <h3
          style="
            margin-bottom: 16px;
            color: #374151;
            font-size: 1.1rem;
            font-weight: 600;
          "
        >
          필터 옵션
        </h3>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
          "
        >
          <div>
            <label
              style="
                display: block;
                margin-bottom: 8px;
                color: #374151;
                font-weight: 500;
                font-size: 0.875rem;
              "
              >우선순위</label
            >
            <select
              id="priority-filter"
              style="
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background: white;
                font-size: 0.875rem;
              "
            >
              <option value="">모든 우선순위</option>
              <option value="1">Priority 1 (높음)</option>
              <option value="2">Priority 2 (중간)</option>
              <option value="3">Priority 3 (낮음)</option>
            </select>
          </div>
          <div>
            <label
              style="
                display: block;
                margin-bottom: 8px;
                color: #374151;
                font-weight: 500;
                font-size: 0.875rem;
              "
              >챕터</label
            >
            <select
              id="chapter-filter"
              style="
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background: white;
                font-size: 0.875rem;
              "
            >
              <option value="">모든 챕터</option>
            </select>
          </div>
          <div>
            <label
              style="
                display: block;
                margin-bottom: 8px;
                color: #374151;
                font-weight: 500;
                font-size: 0.875rem;
              "
              >테마</label
            >
            <select
              id="theme-filter"
              style="
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background: white;
                font-size: 0.875rem;
              "
            >
              <option value="">모든 테마</option>
            </select>
          </div>
        </div>
        <div
          style="
            margin-top: 16px;
            display: flex;
            gap: 12px;
            align-items: center;
          "
        >
          <button
            id="apply-filter"
            style="
              padding: 8px 16px;
              background: #3b82f6;
              color: white;
              border: none;
              border-radius: 6px;
              font-weight: 500;
              cursor: pointer;
              font-size: 0.875rem;
            "
          >
            필터 적용
          </button>
          <button
            id="clear-filter"
            style="
              padding: 8px 16px;
              background: #6b7280;
              color: white;
              border: none;
              border-radius: 6px;
              font-weight: 500;
              cursor: pointer;
              font-size: 0.875rem;
            "
          >
            필터 초기화
          </button>
          <span
            id="filter-count"
            style="color: #6b7280; font-size: 0.875rem"
          ></span>
        </div>
      </div>

      <div class="content">
        <div id="csv-table"></div>

        <div id="statistics" style="margin-top: 48px">
          <h2
            style="
              margin-bottom: 24px;
              color: #111827;
              font-size: 1.5rem;
              font-weight: 600;
            "
          >
            통계 정보
          </h2>
          <div id="stats-content"></div>
        </div>
      </div>
    </div>

    <div class="floating-scroll">
      <button class="scroll-btn top" id="scrollToTop" title="맨 위로">↑</button>
      <button class="scroll-btn bottom" id="scrollToBottom" title="맨 아래로">
        ↓
      </button>
    </div>

    <script>
      let allCsvData = [];
      let filteredData = [];
      let currentTable = null;

      function parseCsvRow(rowString) {
        const cells = [];
        let currentPos = 0;

        // First column (unquoted)
        const firstComma = rowString.indexOf(",");
        if (firstComma === -1) {
          return [rowString];
        }
        cells.push(rowString.substring(0, firstComma));
        currentPos = firstComma + 1;

        // Other columns (quoted)
        while (currentPos < rowString.length) {
          if (rowString[currentPos] === '"') {
            let endQuote = -1;
            let searchPos = currentPos + 1;
            while (endQuote === -1) {
              const nextQuote = rowString.indexOf('"', searchPos);
              if (nextQuote === -1) {
                // Malformed, no closing quote
                endQuote = rowString.length;
              } else if (rowString[nextQuote + 1] === '"') {
                // Escaped quote
                searchPos = nextQuote + 2;
              } else {
                endQuote = nextQuote;
              }
            }
            cells.push(
              rowString.substring(currentPos + 1, endQuote).replace(/""/g, '"')
            );
            currentPos = endQuote + 2; // Move past quote and comma
          } else {
            // Fallback for unquoted values, though not expected in this format
            const nextComma = rowString.indexOf(",", currentPos);
            if (nextComma === -1) {
              cells.push(rowString.substring(currentPos));
              currentPos = rowString.length;
            } else {
              cells.push(rowString.substring(currentPos, nextComma));
              currentPos = nextComma + 1;
            }
          }
        }
        return cells;
      }

      function loadCsvData(csvFile) {
        return fetch(csvFile)
          .then((response) => response.text())
          .then((data) => {
            const rows = data.trim().split("\n");
            const headers = rows[0].split(",");
            const parsedData = [];

            for (let i = 1; i < rows.length; i++) {
              if (!rows[i]) continue;
              try {
                const cells = parseCsvRow(rows[i]);
                parsedData.push({
                  chapter: cells[0]?.replace(/"/g, ""),
                  theme: cells[1]?.replace(/"/g, ""),
                  problemNumber: cells[2]?.replace(/"/g, ""),
                  reason: cells[3]?.replace(/"/g, ""),
                  priority: cells[4]?.replace(/"/g, ""),
                  originalRow: rows[i],
                });
              } catch (error) {
                console.error("Error parsing row:", i + 2, rows[i], error);
              }
            }

            return { headers, data: parsedData };
          });
      }

      function populateFilterOptions(data) {
        const chapters = [
          ...new Set(data.map((item) => item.chapter).filter(Boolean)),
        ];
        const themes = [
          ...new Set(data.map((item) => item.theme).filter(Boolean)),
        ];

        const chapterFilter = document.getElementById("chapter-filter");
        const themeFilter = document.getElementById("theme-filter");

        chapterFilter.innerHTML = '<option value="">모든 챕터</option>';
        chapters.forEach((chapter) => {
          const option = document.createElement("option");
          option.value = chapter;
          option.textContent = chapter;
          chapterFilter.appendChild(option);
        });

        themeFilter.innerHTML = '<option value="">모든 테마</option>';
        themes.forEach((theme) => {
          const option = document.createElement("option");
          option.value = theme;
          option.textContent = theme;
          themeFilter.appendChild(option);
        });
      }

      function applyFilters() {
        const priorityFilter = document.getElementById("priority-filter").value;
        const chapterFilter = document.getElementById("chapter-filter").value;
        const themeFilter = document.getElementById("theme-filter").value;

        filteredData = allCsvData.filter((item) => {
          const priorityMatch =
            !priorityFilter || item.priority === priorityFilter;
          const chapterMatch = !chapterFilter || item.chapter === chapterFilter;
          const themeMatch = !themeFilter || item.theme === themeFilter;

          return priorityMatch && chapterMatch && themeMatch;
        });

        displayFilteredTable();
        updateFilterCount();
      }

      function displayFilteredTable() {
        const container = document.getElementById("csv-table");
        container.innerHTML = "";

        if (filteredData.length === 0) {
          container.innerHTML =
            '<div class="info-message">선택한 조건에 맞는 문제가 없습니다.</div>';
          return;
        }

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        const headers = [
          "Chapter",
          "Theme",
          "문제 번호",
          "분류 이유",
          "Priority",
        ];
        headers.forEach((headerText) => {
          const th = document.createElement("th");
          th.textContent = headerText;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        filteredData.forEach((item) => {
          const row = document.createElement("tr");

          const chapterTd = document.createElement("td");
          chapterTd.textContent = item.chapter;
          row.appendChild(chapterTd);

          const themeTd = document.createElement("td");
          themeTd.textContent = item.theme;
          row.appendChild(themeTd);

          const problemTd = document.createElement("td");
          problemTd.textContent = item.problemNumber;
          row.appendChild(problemTd);

          const reasonTd = document.createElement("td");
          reasonTd.textContent = item.reason;
          row.appendChild(reasonTd);

          const priorityTd = document.createElement("td");
          priorityTd.textContent = item.priority;
          row.appendChild(priorityTd);

          if (item.priority === "1") {
            row.classList.add("priority-1");
          } else if (item.priority === "2") {
            row.classList.add("priority-2");
          } else if (item.priority === "3") {
            row.classList.add("priority-3");
          }

          tbody.appendChild(row);
        });
        table.appendChild(tbody);

        container.appendChild(table);
        currentTable = table;
      }

      function updateFilterCount() {
        const countElement = document.getElementById("filter-count");
        countElement.textContent = `총 ${filteredData.length}개 문제 표시`;
      }

      function clearFilters() {
        document.getElementById("priority-filter").value = "";
        document.getElementById("chapter-filter").value = "";
        document.getElementById("theme-filter").value = "";
        filteredData = [...allCsvData];
        displayFilteredTable();
        updateFilterCount();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const csvFile = urlParams.get("csv");

        if (csvFile) {
          const statsSection = document.getElementById("statistics");
          if (statsSection) {
            statsSection.style.display = "none";
          }

          loadCsvData(csvFile)
            .then(({ data }) => {
              allCsvData = data;

              if (csvFile === "all.csv") {
                const filterControls =
                  document.querySelector(".filter-controls");
                if (filterControls) {
                  filterControls.style.display = "block";
                }
                populateFilterOptions(allCsvData);
                applyFilters();
              } else {
                const filterControls =
                  document.querySelector(".filter-controls");
                if (filterControls) {
                  filterControls.style.display = "none";
                }

                const table = document.createElement("table");
                const thead = document.createElement("thead");
                const headerRow = document.createElement("tr");
                const headers = [
                  "Chapter",
                  "Theme",
                  "문제 번호",
                  "분류 이유",
                  "Priority",
                ];
                headers.forEach((headerText) => {
                  const th = document.createElement("th");
                  th.textContent = headerText;
                  headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement("tbody");
                data.forEach((item) => {
                  const row = document.createElement("tr");

                  const chapterTd = document.createElement("td");
                  chapterTd.textContent = item.chapter;
                  row.appendChild(chapterTd);

                  const themeTd = document.createElement("td");
                  themeTd.textContent = item.theme;
                  row.appendChild(themeTd);

                  const problemTd = document.createElement("td");
                  problemTd.textContent = item.problemNumber;
                  row.appendChild(problemTd);

                  const reasonTd = document.createElement("td");
                  reasonTd.textContent = item.reason;
                  row.appendChild(reasonTd);

                  const priorityTd = document.createElement("td");
                  priorityTd.textContent = item.priority;
                  row.appendChild(priorityTd);

                  if (item.priority === "1") {
                    row.classList.add("priority-1");
                  } else if (item.priority === "2") {
                    row.classList.add("priority-2");
                  } else if (item.priority === "3") {
                    row.classList.add("priority-3");
                  }

                  tbody.appendChild(row);
                });
                table.appendChild(tbody);

                const container = document.getElementById("csv-table");
                container.innerHTML = "";
                container.appendChild(table);
              }
            })
            .catch((error) => {
              console.error("Error loading CSV file:", error);
              document.getElementById(
                "csv-table"
              ).innerHTML = `<div class="error-message">Error loading ${csvFile}. Please make sure the file exists and is in the same directory as this HTML file.</div>`;
            });
        } else {
          document.getElementById("csv-table").innerHTML =
            '<div class="info-message">볼 CSV 파일을 지정하세요. 예를 들어 URL에 "?csv=1.csv"를 추가합니다.</div>';

          loadStatistics();
        }

        document
          .getElementById("apply-filter")
          .addEventListener("click", applyFilters);
        document
          .getElementById("clear-filter")
          .addEventListener("click", clearFilters);

        document.getElementById("scrollToTop").addEventListener("click", () => {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        });

        document
          .getElementById("scrollToBottom")
          .addEventListener("click", () => {
            window.scrollTo({
              top: document.body.scrollHeight,
              behavior: "smooth",
            });
          });

        const filterControls = document.querySelector(".filter-controls");
        if (filterControls) {
          filterControls.style.display = "none";
        }
      });

      function loadStatistics() {
        Promise.all([
          fetch("all.csv").then((response) => response.text()),
          fetch("1.csv").then((response) => response.text()),
          fetch("2.csv").then((response) => response.text()),
          fetch("3.csv").then((response) => response.text()),
          fetch("4.csv").then((response) => response.text()),
        ])
          .then(([allData, csv1Data, csv2Data, csv3Data, csv4Data]) => {
            const stats = analyzeData(allData);
            displayStatistics(stats);

            const validationResult = validateCsvFiles(allData, [
              csv1Data,
              csv2Data,
              csv3Data,
              csv4Data,
            ]);
            displayValidationResult(validationResult);
          })
          .catch((error) => {
            console.error("Error loading statistics:", error);
            document.getElementById("stats-content").innerHTML =
              '<div class="error-message">통계 정보를 불러올 수 없습니다.</div>';
          });
      }

      function analyzeData(csvData) {
        const rows = csvData.trim().split("\n");
        const headers = rows[0].split(",");
        const data = rows.slice(1).map((row, index) => {
          try {
            const cells = parseCsvRow(row);
            return {
              chapter: cells[0]?.replace(/"/g, ""),
              theme: cells[1]?.replace(/"/g, ""),
              problemNumber: cells[2]?.replace(/"/g, ""),
              reason: cells[3]?.replace(/"/g, ""),
            };
          } catch (error) {
            console.log(
              "Error parsing row in analyzeData:",
              index + 2,
              row,
              error
            );
            return {
              chapter: "",
              theme: "",
              problemNumber: "",
              reason: "",
            };
          }
        });

        const chapterStats = {};
        const themeStats = {};
        const yearStats = {};
        const totalProblems = data.length;

        data.forEach((item) => {
          if (item.chapter && item.theme) {
            const chapter = item.chapter.trim();
            const theme = item.theme.trim();

            chapterStats[chapter] = (chapterStats[chapter] || 0) + 1;

            const combinedTheme = `${chapter} - ${theme}`;
            themeStats[combinedTheme] = (themeStats[combinedTheme] || 0) + 1;

            if (item.problemNumber) {
              const year = item.problemNumber.split(".")[0];
              if (year && year.length === 4) {
                yearStats[year] = (yearStats[year] || 0) + 1;
              }
            }
          }
        });

        return {
          totalProblems,
          chapterStats,
          themeStats,
          yearStats,
        };
      }

      function validateCsvFiles(allData, individualCsvData) {
        const allRows = allData.trim().split("\n").slice(1);
        const allProblems = new Set();

        console.log("All CSV rows count:", allRows.length);

        allRows.forEach((row, index) => {
          if (row.trim()) {
            try {
              const cells = parseCsvRow(row);
              const problemNumber = cells[2]?.replace(/"/g, "").trim();
              if (problemNumber) {
                allProblems.add(problemNumber);
              } else {
                console.log("Row without problem number:", index + 2, row);
                console.log("Parsed cells:", cells);
              }
            } catch (error) {
              console.log("Error parsing row:", index + 2, row, error);
            }
          }
        });

        console.log("All problems count:", allProblems.size);
        console.log("All problems:", Array.from(allProblems).sort());

        const individualProblems = new Set();
        const missingInAll = [];
        const extraInAll = [];
        const csvFileStats = [];

        individualCsvData.forEach((csvData, index) => {
          const csvNumber = index + 1;
          const rows = csvData.trim().split("\n").slice(1);
          const csvProblems = [];

          rows.forEach((row) => {
            if (row.trim()) {
              try {
                const cells = parseCsvRow(row);
                const problemNumber = cells[2]?.replace(/"/g, "").trim();
                if (problemNumber) {
                  csvProblems.push(problemNumber);
                  individualProblems.add(problemNumber);
                }
              } catch (error) {
                console.log(
                  "Error parsing individual CSV row:",
                  csvNumber,
                  row,
                  error
                );
              }
            }
          });

          csvFileStats.push({
            file: `${csvNumber}.csv`,
            count: csvProblems.length,
            problems: csvProblems,
          });
        });

        console.log("Individual problems count:", individualProblems.size);
        console.log(
          "Individual problems:",
          Array.from(individualProblems).sort()
        );

        allProblems.forEach((problem) => {
          if (!individualProblems.has(problem)) {
            extraInAll.push(problem);
          }
        });

        individualProblems.forEach((problem) => {
          if (!allProblems.has(problem)) {
            missingInAll.push(problem);
          }
        });

        return {
          allCount: allProblems.size,
          individualCount: individualProblems.size,
          missingInAll,
          extraInAll,
          csvFileStats,
          isValid: missingInAll.length === 0 && extraInAll.length === 0,
        };
      }

      function displayValidationResult(validationResult) {
        const statsContent = document.getElementById("stats-content");

        let validationHtml = `
          <div style="margin-top: 48px;">
            <h2 style="margin-bottom: 24px; color: #111827; font-size: 1.5rem; font-weight: 600;">
              CSV 파일 검증 결과
            </h2>
        `;

        if (validationResult.isValid) {
          validationHtml += `
            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; padding: 16px 20px; border-radius: 8px; margin-bottom: 24px;">
              <div style="display: flex; align-items: center; gap: 8px; font-weight: 600; margin-bottom: 8px;">
                <span style="font-size: 1.2rem;">✓</span>
                검증 성공
              </div>
              <p>all.csv 파일이 개별 CSV 파일들의 합계와 일치합니다.</p>
            </div>
          `;
        } else {
          validationHtml += `
            <div style="background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; padding: 16px 20px; border-radius: 8px; margin-bottom: 24px;">
              <div style="display: flex; align-items: center; gap: 8px; font-weight: 600; margin-bottom: 8px;">
                <span style="font-size: 1.2rem;">✗</span>
                검증 실패
              </div>
              <p>all.csv 파일과 개별 CSV 파일들 간에 불일치가 발견되었습니다.</p>
            </div>
          `;
        }

        validationHtml += `
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 32px;">
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px;">
              <h3 style="color: #374151; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px;">all.csv 문제 수</h3>
              <div style="font-size: 2rem; font-weight: 700; color: #1f2937;">${validationResult.allCount}문제</div>
            </div>
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px;">
              <h3 style="color: #374151; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px;">개별 CSV 합계</h3>
              <div style="font-size: 2rem; font-weight: 700; color: #1f2937;">${validationResult.individualCount}문제</div>
            </div>
          </div>
        `;

        validationHtml += `
          <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 24px;">
            <div style="background: #f9fafb; padding: 12px 16px; border-bottom: 1px solid #e5e7eb;">
              <h3 style="color: #374151; font-size: 1.25rem; font-weight: 600;">개별 CSV 파일 통계</h3>
            </div>
        `;

        validationResult.csvFileStats.forEach((stat) => {
          validationHtml += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #f3f4f6;">
              <span style="color: #374151; font-weight: 500;">${stat.file}</span>
              <span style="color: #1f2937; font-weight: 600;">${stat.count}문제</span>
            </div>
          `;
        });

        validationHtml += `</div>`;

        if (validationResult.missingInAll.length > 0) {
          validationHtml += `
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 24px;">
              <div style="background: #fef2f2; padding: 12px 16px; border-bottom: 1px solid #e5e7eb;">
                <h3 style="color: #991b1b; font-size: 1.25rem; font-weight: 600;">all.csv에 누락된 문제 (${validationResult.missingInAll.length}개)</h3>
              </div>
          `;

          validationResult.missingInAll.forEach((problem) => {
            validationHtml += `
              <div style="padding: 8px 16px; border-bottom: 1px solid #f3f4f6;">
                <span style="color: #991b1b;">${problem}</span>
              </div>
            `;
          });

          validationHtml += `</div>`;
        }

        if (validationResult.extraInAll.length > 0) {
          validationHtml += `
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 24px;">
              <div style="background: #fef2f2; padding: 12px 16px; border-bottom: 1px solid #e5e7eb;">
                <h3 style="color: #991b1b; font-size: 1.25rem; font-weight: 600;">all.csv에만 있는 문제 (${validationResult.extraInAll.length}개)</h3>
              </div>
          `;

          validationResult.extraInAll.forEach((problem) => {
            validationHtml += `
              <div style="padding: 8px 16px; border-bottom: 1px solid #f3f4f6;">
                <span style="color: #991b1b;">${problem}</span>
              </div>
            `;
          });

          validationHtml += `</div>`;
        }

        validationHtml += `</div>`;

        statsContent.innerHTML += validationHtml;
      }

      function displayStatistics(stats) {
        const statsContent = document.getElementById("stats-content");

        let html = `
              <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 32px;">
                  <div class="stat-card" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);">
                      <h3 style="color: #374151; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px;">총 문제 수</h3>
                      <div style="font-size: 2rem; font-weight: 700; color: #1f2937;">${
                        stats.totalProblems
                      }문제</div>
                  </div>
                  
                  <div class="stat-card" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);">
                      <h3 style="color: #374151; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px;">챕터 수</h3>
                      <div style="font-size: 2rem; font-weight: 700; color: #1f2937;">${
                        Object.keys(stats.chapterStats).length
                      }개</div>
                  </div>
                  
                  <div class="stat-card" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);">
                      <h3 style="color: #374151; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px;">테마 수</h3>
                      <div style="font-size: 2rem; font-weight: 700; color: #1f2937;">${
                        Object.keys(stats.themeStats).length
                      }개</div>
                  </div>
              </div>
          `;

        html += `
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 32px;">
                  <div class="stat-section">
                      <h3 style="color: #374151; font-size: 1.25rem; font-weight: 600; margin-bottom: 16px;">챕터별 문제 수</h3>
                      <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
          `;

        Object.entries(stats.chapterStats)
          .sort((a, b) => b[1] - a[1])
          .forEach(([chapter, count]) => {
            const percentage = ((count / stats.totalProblems) * 100).toFixed(1);
            html += `
                      <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #f3f4f6;">
                          <span style="color: #374151; font-weight: 500;">${chapter}</span>
                          <div style="display: flex; align-items: center; gap: 12px;">
                              <span style="color: #6b7280; font-size: 0.875rem;">${percentage}%</span>
                              <span style="color: #1f2937; font-weight: 600;">${count}문제</span>
                          </div>
                      </div>
                  `;
          });

        html += `
                      </div>
                  </div>
                  
                  <div class="stat-section">
                      <h3 style="color: #374151; font-size: 1.25rem; font-weight: 600; margin-bottom: 16px;">연도별 문제 수</h3>
                      <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
          `;

        Object.entries(stats.yearStats)
          .sort((a, b) => b[0] - a[0])
          .forEach(([year, count]) => {
            const percentage = ((count / stats.totalProblems) * 100).toFixed(1);
            html += `
                      <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #f3f4f6;">
                          <span style="color: #374151; font-weight: 500;">${year}년</span>
                          <div style="display: flex; align-items: center; gap: 12px;">
                              <span style="color: #6b7280; font-size: 0.875rem;">${percentage}%</span>
                              <span style="color: #1f2937; font-weight: 600;">${count}문제</span>
                          </div>
                      </div>
                  `;
          });

        html += `
                      </div>
                  </div>
              </div>
          `;

        const chapterThemeStats = {};
        Object.entries(stats.themeStats).forEach(([theme, count]) => {
          console.log("Theme:", theme, "Count:", count);
          const chapterMatch = theme.match(/Chapter (\d+):/);
          if (chapterMatch) {
            const chapterNum = chapterMatch[1];
            if (!chapterThemeStats[chapterNum]) {
              chapterThemeStats[chapterNum] = [];
            }
            chapterThemeStats[chapterNum].push({ theme, count });
          }
        });

        console.log("Chapter Theme Stats:", chapterThemeStats);

        html += `
            <div style="margin-top: 32px;">
                <h3 style="color: #374151; font-size: 1.25rem; font-weight: 600; margin-bottom: 16px;">테마별 문제 수</h3>
        `;

        if (Object.keys(chapterThemeStats).length === 0) {
          html += `
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; text-align: center;">
              <p style="color: #6b7280;">테마 데이터를 찾을 수 없습니다. 테마 형식을 확인해주세요.</p>
            </div>
          `;
        } else {
          Object.keys(chapterThemeStats)
            .sort((a, b) => parseInt(a) - parseInt(b))
            .forEach((chapterNum) => {
              const themes = chapterThemeStats[chapterNum];
              const chapterTotal = themes.reduce(
                (sum, item) => sum + item.count,
                0
              );
              const chapterPercentage = (
                (chapterTotal / stats.totalProblems) *
                100
              ).toFixed(1);

              html += `
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 16px;">
                        <div style="background: #f9fafb; padding: 12px 16px; border-bottom: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #374151; font-weight: 600; font-size: 1.1rem;">Chapter ${chapterNum}</span>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="color: #6b7280; font-size: 0.875rem;">${chapterPercentage}%</span>
                                    <span style="color: #1f2937; font-weight: 600;">${chapterTotal}문제</span>
                                </div>
                            </div>
                        </div>
                `;

              themes
                .sort((a, b) => {
                  const themeAMatch = a.theme.match(/Theme (\d+)/);
                  const themeBMatch = b.theme.match(/Theme (\d+)/);
                  if (themeAMatch && themeBMatch) {
                    return parseInt(themeAMatch[1]) - parseInt(themeBMatch[1]);
                  }
                  return a.theme.localeCompare(b.theme);
                })
                .forEach(({ theme, count }) => {
                  const percentage = (
                    (count / stats.totalProblems) *
                    100
                  ).toFixed(1);
                  const themeMatch = theme.match(/Theme (\d+):\s*(.+)/);
                  if (themeMatch) {
                    const themeNum = themeMatch[1];
                    const themeName = themeMatch[2];
                    html += `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #f3f4f6;">
                                    <span style="color: #374151; font-weight: 500; padding-left: 16px;">Theme ${themeNum}: ${themeName}</span>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <span style="color: #6b7280; font-size: 0.875rem;">${percentage}%</span>
                                        <span style="color: #1f2937; font-weight: 600;">${count}문제</span>
                                    </div>
                                </div>
                            `;
                  } else {
                    html += `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #f3f4f6;">
                                    <span style="color: #374151; font-weight: 500; padding-left: 16px;">${theme}</span>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <span style="color: #6b7280; font-size: 0.875rem;">${percentage}%</span>
                                        <span style="color: #1f2937; font-weight: 600;">${count}문제</span>
                                    </div>
                                </div>
                            `;
                  }
                });

              html += `</div>`;
            });
        }

        html += `</div>`;

        statsContent.innerHTML = html;
      }
    </script>
  </body>
  <footer style="text-align: center; padding: 20px; font-size: 12px">
    Copyright ⓒ 2025 sid12g All rights reserved.
  </footer>
</html>
